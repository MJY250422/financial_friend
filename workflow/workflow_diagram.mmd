graph TB
    subgraph "1. 데이터 수집 레이어"
        A1[뉴스 API 수집<br/>feedparser + trafilatura]
        A2[5대 언론사<br/>한경/매경/헤경/조경/한겨례]
        A3[RSS Feed + REST API]
        A4[JSON 표준화]
        
        A2 --> A1
        A3 --> A1
        A1 --> A4
    end
    
    subgraph "2. 데이터 처리 및 저장"
        B1[텍스트 전처리<br/>문단 단위 분할]
        B2[임베딩 생성<br/>e5-small-v2/bge-small]
        B3[벡터 저장<br/>ChromaDB]
        B4[메타데이터 저장<br/>SQLite]
        B5[백업<br/>CSV]
        
        A4 --> B1
        B1 --> B2
        B2 --> B3
        B1 --> B4
        B4 --> B5
    end
    
    subgraph "3. 금융 용어집 구축"
        C1[공식 금융기관<br/>용어집 수집]
        C2[용어-정의 매핑]
        C3[용어 임베딩]
        C4[Glossary DB<br/>ChromaDB]
        
        C1 --> C2
        C2 --> C3
        C3 --> C4
    end
    
    subgraph "4. 사용자 인터페이스"
        D1[Streamlit<br/>웹 인터페이스]
        D2[사용자 질의 입력]
        D3[프로필/로그 관리<br/>SQLite]
        
        D1 --> D2
        D2 --> D3
    end
    
    subgraph "5. Agent 라우팅 시스템"
        E1[의도 분석<br/>LLM 기반]
        E2{질의 유형 분류}
        E3[뉴스 브리핑 Agent]
        E4[금융 용어 학습 Agent]
        
        D2 --> E1
        E1 --> E2
        E2 -->|뉴스 관련| E3
        E2 -->|용어 학습| E4
    end
    
    subgraph "6. 검색 및 캐싱"
        F1[Redis 캐시 확인]
        F2[벡터 유사도 검색<br/>ChromaDB]
        F3[관련 문서 추출<br/>Top-K Retrieval]
        F4[캐시 저장]
        
        E3 --> F1
        E4 --> F1
        F1 -->|Cache Miss| F2
        F1 -->|Cache Hit| G1
        F2 --> F3
        F3 --> F4
    end
    
    subgraph "7. LLM 응답 생성"
        G1[컨텍스트 구성<br/>검색 문서 + 질의]
        G2[LLM 추론<br/>GPT-4 / Llama-3 8B]
        G3[응답 포맷팅<br/>정의-QA-뉴스-연결-출처]
        
        F3 --> G1
        F4 --> G1
        G1 --> G2
        G2 --> G3
    end
    
    subgraph "8. 검증 및 안전성 필터"
        H1[출처 검증<br/>Source Validation]
        H2[신뢰도 평가<br/>Confidence Score]
        H3[안전성 필터링<br/>Harmful Content Check]
        H4[최종 응답 승인]
        
        G3 --> H1
        H1 --> H2
        H2 --> H3
        H3 --> H4
    end
    
    subgraph "9. 응답 전달"
        I1[응답 스트리밍<br/>Streamlit UI]
        I2[피드백 수집]
        I3[로그 저장<br/>SQLite]
        
        H4 --> I1
        I1 --> I2
        I2 --> I3
    end
    
    B3 -.-> F2
    C4 -.-> F2
    I3 -.-> D3
    
    style A1 fill:#e1f5ff
    style B2 fill:#fff4e1
    style E2 fill:#ffe1f5
    style G2 fill:#e1ffe1
    style H4 fill:#ffe1e1